<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drug Lookup</title>
    <script src="https://unpkg.com/@zxing/library@latest"></script>
    <style>
        body {
            background-color: #3b2c1a;
            color: #add8e6;
            font-family: Arial, sans-serif;
            transition: filter 0.5s;
        }
        .grayscale {
            filter: grayscale(100%);
        }
        #scanner-container {
            display: none;
        }
        #sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            overflow-y: auto;
            padding: 10px;
            display: none;
        }
        button {
            margin: 10px;
            padding: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <button onclick="toggleScanner()">Scan Barcode</button>
    <button onclick="toggleAccessibility()">Toggle Accessibility Mode</button>
    <button onclick="toggleSidebar()">Toggle Drug List</button>
    <input type="text" id="search-input" placeholder="Search by name or NDC">
    <button onclick="manualSearch()">Search</button>
    
    <div id="scanner-container">
        <video id="scanner" width="300" height="200"></video>
    </div>
    <div id="sidebar"></div>
    
    <script>
        let accessibilityMode = false;
        let drugList = [];

        function toggleScanner() {
            const scannerContainer = document.getElementById('scanner-container');
            scannerContainer.style.display = scannerContainer.style.display === 'block' ? 'none' : 'block';
            startScanner();
        }

        function startScanner() {
            const video = document.getElementById('scanner');
            const codeReader = new ZXing.BrowserBarcodeReader();
            codeReader.decodeFromVideoDevice(undefined, video, (result, err) => {
                if (result) {
                    alert('Scanned: ' + result.text);
                    drugList.push(result.text);
                    updateSidebar();
                    saveData(result.text);
                }
            });
        }

        function toggleAccessibility() {
            document.body.classList.toggle('grayscale');
            accessibilityMode = !accessibilityMode;
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.style.display = sidebar.style.display === 'block' ? 'none' : 'block';
        }

        function updateSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.innerHTML = drugList.map(drug => `<p>${drug}</p>`).join('');
        }

        function manualSearch() {
            const searchTerm = document.getElementById('search-input').value;
            if (searchTerm) {
                alert('Searched: ' + searchTerm);
                drugList.push(searchTerm);
                updateSidebar();
                saveData(searchTerm);
            }
        }

        function saveData(data) {
            fetch('/save', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({drug: data})
            });
        }
    </script>
</body>
</html>
