<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medication Reminder</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #2c1b0f;
            color: #a0e0ff;
            margin: 0;
            padding: 20px;
        }
        .container { display: flex; }
        .sidebar {
            width: 20%;
            background: #3a2a1f;
            padding: 10px;
            height: 100vh;
        }
        .main { flex-grow: 1; padding: 20px; }
        .scanner-container, .manual-search {
            margin-bottom: 20px;
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h3>Previous Drugs</h3>
            <ul id="drug-list"></ul>
        </div>
        <div class="main">
            <h1>Medication Scanner & Reminder</h1>
            <button onclick="toggleScanner()">Scan Barcode</button>
            <button onclick="toggleTheme()">Toggle Accessibility Mode</button>
            <div id="scanner-container" class="hidden">
                <video id="scanner" width="300" height="200"></video>
            </div>
            <div class="manual-search">
                <input type="text" id="search-input" placeholder="Enter drug name or NDC">
                <button onclick="manualSearch()">Search</button>
            </div>
            <div id="drug-info"></div>
        </div>
    </div>
    <script>
        let darkMode = true;

        function toggleScanner() {
            let scannerContainer = document.getElementById("scanner-container");
            scannerContainer.classList.toggle("hidden");
            if (!scannerContainer.classList.contains("hidden")) {
                startScanner();
            } else {
                Quagga.stop();
            }
        }

        function startScanner() {
            Quagga.init({
                inputStream: { name: "Live", type: "LiveStream", target: document.querySelector("#scanner") },
                decoder: { readers: ["ean_reader", "upc_reader"] }
            }, function(err) {
                if (!err) { Quagga.start(); }
            });
            Quagga.onDetected(data => {
                fetchDrugInfo(data.codeResult.code);
                Quagga.stop();
            });
        }

        function fetchDrugInfo(code) {
            fetch(`https://api.fda.gov/drug/ndc.json?search=product_ndc:${code}`)
                .then(response => response.json())
                .then(data => {
                    if (data.results) {
                        let drug = data.results[0];
                        document.getElementById("drug-info").innerHTML = `<h2>${drug.brand_name}</h2><p>${drug.dosage_form}</p>`;
                        addDrugToList(drug.brand_name);
                        requestNotification();
                    }
                });
        }

        function manualSearch() {
            let query = document.getElementById("search-input").value;
            fetch(`https://api.fda.gov/drug/ndc.json?search=brand_name:${query}`)
                .then(response => response.json())
                .then(data => {
                    if (data.results) {
                        let drug = data.results[0];
                        document.getElementById("drug-info").innerHTML = `<h2>${drug.brand_name}</h2><p>${drug.dosage_form}</p>`;
                        addDrugToList(drug.brand_name);
                        requestNotification();
                    }
                });
        }

        function addDrugToList(name) {
            let list = document.getElementById("drug-list");
            let item = document.createElement("li");
            item.textContent = name;
            list.appendChild(item);
        }

        function requestNotification() {
            if (Notification.permission !== "granted") {
                Notification.requestPermission();
            } else {
                let time = prompt("Enter reminder time in minutes:");
                setTimeout(() => new Notification("Medication Reminder!"), time * 60000);
            }
        }

        function toggleTheme() {
            darkMode = !darkMode;
            document.body.style.backgroundColor = darkMode ? "#2c1b0f" : "#888";
            document.body.style.color = darkMode ? "#a0e0ff" : "black";
        }
    </script>
</body>
</html>
